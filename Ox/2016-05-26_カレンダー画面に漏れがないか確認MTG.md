# カレンダー画面に漏れがないか確認MTG

サイボウズ予定 : http://cybozu.intra.cybird.co.jp/cgi-bin/cbag/ag.exe?page=ScheduleView&UID=36425&GID=&Date=da.2016.5.26&BDate=da.2016.5.26&sEID=8321982&CP=sg&BK=1

メンバー : 阪口、繁田、楢原、水越、鈴木、阿部、井上、橋本

## ストーリーのチェックAPI

今の仕様だとcompleteTicket APIで初めてチケットや魔法石を消費する為、チケットがない状態でも1話余計に読めてしまう。

なのでストーリーを読む前に読めるかチェックするAPIが必要。

仕様はこれ

```markdown
# サブストーリーが読めるかどうの判定

### ACTION

readmainstory

### Role

- 送られた”ticket_id”の存在チェックとユーザーの購入済みかのチェックを行う
- ticket_idに紐づくストーリーが読めない場合は、不正な遷移だと思われる為、エラーを返す

### params

\`\`\`
"requests": [
    {
        "action": "readsubstory",
 		"data":{
          "ticket_id" : 1
        }
    }
]
\`\`\`

|key|value|memo|
| :-----: | --- | :---: |
|ticket_id|int|チケットID|


### response

\`\`\`

\`\`\`


### error

|code|error|mssage|
| :-----: | --- | :---: |
|440|NotHaveStoryTicketError|ユーザストーリ情報が取得できません。|
```

```markdown
# サブストーリーが読めるかどうの判定

### ACTION

readmainstory

### Role

- 送られた”ticket_id”の存在チェックとユーザーの購入済みかのチェックを行う
- ticket_idに紐づくストーリーが読めない場合は、不正な遷移だと思われる為、エラーを返す

### params

\`\`\`
"requests": [
    {
        "action": "readsubstory",
 		"data":{
          "ticket_id" : 1
        }
    }
]
\`\`\`

|key|value|memo|
| :-----: | --- | :---: |
|ticket_id|int|チケットID|


### response

\`\`\`

\`\`\`


### error

|code|error|mssage|
| :-----: | --- | :---: |
|440|NotHaveStoryTicketError|ユーザストーリ情報が取得できません。|
```

## 彼目線の読了画面

彼目線の読了画面に何を出せばよいか、構成案にない。
→ UI班に確認。

ボーナスストーリー(アバターミッション後)の読了画面も同じ。
→ UI班に確認。

## 読了画面

アバターミッションを"ノーマルアバター"でクリア後、読了画面に「プレミアストーリーを獲得しました。」の文言が出る。
→ 今デプロイされているソースではプレミア/ノーマルを区別していない。

そこら辺の表示が仮すぎて、本当に必要な情報がわからない。
→ UI班待ち。

手紙獲得時に彼カード購入遷移が出てる。
→ スチル獲得時に修正。

ルートクリア時、今までの仕様はルートクリア特典を表示するだけの普通の読了画面(実装済み)だが、変更はあるか？
→ UI班に確認。

## カレンダー

カレンダーからのプレミアストーリーの再生
→ リソースのストーリーのタイプ指定が間違っている > 楢原
→ もう直してる。次のverから見れるはず。

ルートクリア後、他のキャラを選択する前にカレンダー画面に来たらどうなるか？
→ キャラ選択画面に行く？

## ルート分岐

ルート分岐発生時の読了画面になにを出すか。
→ UI班に確認。

## 阪口さんメモ

```
彼目線はAPIのデプロイ、疎通待ち
 => 彼目線がそのまま読める、2回目以降も読める
 => カレンダーリソース出力処理に彼目線が何チケットで解放か追加
 => アプリも彼目線解放判定をチケット単位に修正

カレンダーからプレミアストーリーの再生
 => 新しいアプリのバージョンで確認

5話5チケでスチルgetできている
 => 彼カード購入遷移がでているので調査

手紙獲得できていない
 => 新しいAPIデプロイされたら確認

ルート分岐ができない
 => 読了画面の実装(js、API、リソースの準備)
 => カレンダーAPIの中で選べるルートを返す
 => ルート確定用のAPIが新規実装か、使っているのがあるかを確認
 => アプリでモーダルを出す、ルート確定用の処理、ルート確定後

ルートクリア
 => 読了画面にいけない。クリア時のcompleteTicketAPIを修正

2周目にはいるときマイページ、カレンダーへのボタンおしたら、キャラ選択に遷移することになっているか
 => jsは実装済、mypageAPI？の修正が必要か確認

キャラ変更したとき
 => とりあえず2キャラ目のリソース出力をする(3話分ぐらい)
 => キャラ変更、何話何チケが変わってないか確認
 => ミッション発生中にキャラ変更して、ストーリー進めるか。そのキャラに戻ってきてミッションが発生するかどうか確認
 => ミッション発生中にキャラ変更した場合、パラメータミッションのボーダーが仕様通りになってるか確認

カレンダーのボイス再生確認
 => データ用意してリソース出力してボイス

メモリハック対策のcheckAPIの作成
 => readMainStoryAPIを作成
 => readSubStoryAPIを作成
 => アプリのAPI叩く処理



UI班に確認すること
- 彼目線の読了は何を表示すればいいのか？
- ノーマル/プレミアの読了
- 一番最後の読了
- ノーマル/プレミア獲得後のカレンダーの表示
- ルート分岐の読了画面でなにを表示するか
- カレンダーでルート分岐前と後をどう表示するか。一連の画面のフローを確認
- 最終話の読了画面でなにを表示するか。特別な表示、遷移、演出いるかどうか？

POに確認すること
 - 選択肢が本編以外であるかどうか
 - メモリハックされて選択肢が再選択されても大丈夫かどうか
  - 懸念: 好感度が上がり続けるのが大丈夫かどうか
```

## 新たに発生したチケット

http://redmine.ls.aws.cybird.ne.jp/issues/139961
http://redmine.ls.aws.cybird.ne.jp/issues/139963
http://redmine.ls.aws.cybird.ne.jp/issues/139965
http://redmine.ls.aws.cybird.ne.jp/issues/139968
http://redmine.ls.aws.cybird.ne.jp/issues/139970
http://redmine.ls.aws.cybird.ne.jp/issues/139977
http://redmine.ls.aws.cybird.ne.jp/issues/139979
http://redmine.ls.aws.cybird.ne.jp/issues/139980
http://redmine.ls.aws.cybird.ne.jp/issues/139981
http://redmine.ls.aws.cybird.ne.jp/issues/139984
http://redmine.ls.aws.cybird.ne.jp/issues/139985